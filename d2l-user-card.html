<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="../d2l-icons/d2l-icons.html">
<link rel="import" href="../d2l-image/d2l-image.html">
<link rel="import" href="../d2l-card/d2l-card.html">
<link rel="import" href="icons.html">
<!--
`d2l-user-card` is a Polymer-based web component for creating a user card.
@demo demo/index.html
-->
<dom-module id="d2l-user-card">
	<template strip-whitespace>
		<style>
			:host {
				width: 350px;
				height: 350px;
				text-align: center;
				cursor: pointer;
				display: block;
				position: relative;
				animation: fade-in 0.33s forwards;
			}

			:host([hidden]) {
				display: none;
			}

			.user-tile-avatar {
				width: 80px;
				height: 80px;
				margin: auto;
				border: 2px var(--d2l-color-white) solid;
				border-radius: 14px;
				background-color: var(--d2l-color-white);
				overflow: hidden;
				display: inline-block;
			}

			.user-tile-header {
				object-fit: cover;
				object-position: center;
				height: 100px;
				width: 100%;
				z-index: 1;
			}

			.user-tile-background,
			.loading {
				width: 100%;
				height: 100px;
				z-index: -1;
			}

			.user-tile-items {
				padding-left: 20px;
				padding-right: 20px;
				text-align: left;
			}

			.user-tile-default-icon {
				--d2l-icon-height: 100%;
				--d2l-icon-width: 100%;
				--d2l-icon-fill-color: var(--d2l-color-sylvite);
			}

			.user-tile-information-wrapper {
				@apply --d2l-body-compact-text;
				display: flex;
				flex-direction: column;
			}

			.user-tile-name {
				font-size: 1.25rem;
				font-weight: bold;
				margin: 0 auto;
				padding-bottom: 10px;
			}

			.text-placeholder {
				background-color: var(--d2l-color-sylvite);
				width: 150px;
				border-radius: 6px;
			}

			d2l-card {
				--d2l-image-tile-image-height: 100px;
				min-height: 100%;
				width: 100%;
				margin: 0;
			}

			d2l-card[loading] {
				border: 1px var(--d2l-color-gypsum) solid;
			}

			@keyframes fade-out-then-in {
				0% { opacity: 1; }
				50% { opacity: 0; }
				100% { opacity: 1; }
			}

			@keyframes fade-in {
				0% { opacity: 0; }
				100% { opacity: 1; }
			}

			:host([prev-placeholders]:not([placeholders])) {
				animation: fade-out-then-in 0.33s forwards;
			}

			[hidden] {
				display: none;
			}

			@keyframes loadingShimmer {
				0% { transform: translate3d(-100%, 0, 0); }
				100% { transform: translate3d(100%, 0, 0); }
			}

			.d2l-user-tile-loading-shimmer {
				background-color: var(--d2l-color-regolith);
				border-radius: 7px 7px 0 0;
				box-shadow: inset 0 -1px 0 0 var(--d2l-color-gypsum);
				overflow: hidden;
				position: relative;
			}

			.d2l-user-tile-loading-shimmer::after {
				animation: loadingShimmer 1.5s ease-in-out infinite;
				background: linear-gradient(90deg, rgba(249, 250, 251, 0.1), rgba(114, 119, 122, 0.1), rgba(249, 250, 251, 0.1));
				background-color: var(--d2l-color-regolith);
				content: '';
				height: 100%;
				left: 0;
				position: absolute;
				top: 0;
				width: 100%;
			}
		</style>

		<d2l-card
			aria-label$="[[name]]"
			loading$="[[_placeholders]]"
			active$="[[!_placeholders]]"
		>
			<div slot="header">
				<img hidden$="[[!_showBackgroundImage(background, _placeholders)]]" class="user-tile-header" src="[[_getImgUrl(background, _placeholders)]]"></img>
				<div class="user-tile-background" style$="background-color: [[backgroundColor]]" hidden$="[[!_showBackgroundColor(background, _placeholders, backgroundColor)]]"></div>
				<div class="loading d2l-user-tile-loading-shimmer" hidden$="[[!_placeholders]]"></div>
			</div>
			<div slot="badge" class="user-tile-avatar" aria-hidden="true">
				<template is="dom-if" if="[[!_hideIconPlaceholder(icon, _placeholders)]]">
					<d2l-icon icon="navigation-48:profile" class="user-tile-default-icon"></d2l-icon>
				</template>
				<template is="dom-if" if="[[_hideIconPlaceholder(icon, _placeholders)]]">
					<d2l-image image-url="[[icon]]" token="[[token]]"></d2l-image>
				</template>
			</div>
			<div class="user-tile-information-wrapper" slot="content">
				<h3 class="user-tile-name" hidden$="[[!_hideNamePlaceholder(_placeholders, name)]]">[[name]]</h3>
				<p class="user-tile-name text-placeholder" hidden$="[[_hideNamePlaceholder(_placeholders, name)]]">&nbsp;</p>
				<div class="user-tile-items">
					<slot></slot>
				</div>
			</div>
		</d2l-card>
	</template>
	<script>
	'use strict';

	Polymer({
		is: 'd2l-user-card',
		properties: {
			background: String,
			backgroundColor: {
				type: String,
				value: 'white'
			},
			icon: {
				type: String,
				value: null
			},
			name: {
				type: String,
				value: null
			},
			token: {
				type: String,
				value: null
			},
			placeholders: {
				type: Boolean,
				value: false,
				reflectToAttribute: 'true',
				observer: '_updatePlaceholders'
			},
			_placeholders: {
				type: Boolean,
				value: false
			}
		},

		listeners: {
			'd2l-image-failed-to-load': '_onImageLoadFailure'
		},

		_updatePlaceholders: function(placeholders, oldVal) {
			if (oldVal || placeholders) {
				this.setAttribute('prev-placeholders', true);
			}

			setTimeout(function() {
				this._placeholders = placeholders;
			}.bind(this), 160);
		},

		_hideIconPlaceholder: function(icon, placeholders) {
			return !placeholders && !!icon;
		},

		_hideNamePlaceholder: function(placeholders, name) {
			return !placeholders && 'string' === typeof name;
		},

		_onImageLoadFailure: function() {
			this.icon = null;
		},

		_getImgUrl: function(background, placeholders) {
			return placeholders ? '' : background;
		},

		_showBackgroundColor: function(background, placeholders) {
			return !background && !placeholders;
		},

		_showBackgroundImage: function(background, placeholders) {
			return background && !placeholders;
		}
	});
	</script>
</dom-module>
